(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var i in a)e.o(a,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:a[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.plugins,a=window.wp.components,i=window.wp.element,n=window.wp.apiFetch;var r=e.n(n);const o=window.wp.blocks,s=window.wp.data,l=window.ReactJSXRuntime,c=window.GIFilenamePrompt?.nonce||window.wpApiSettings?.nonce;c&&r().use(r().createNonceMiddleware(c));const d={"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp","image/avif":"avif","image/bmp":"bmp","image/tiff":"tiff"},p=e=>d[e]||"png",m=e=>(e||"").toString().trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||"pasted-image",u=()=>{const e=(0,s.select)("core/editor");return(e?.getEditedPostAttribute?e.getEditedPostAttribute("title"):"")||""},g=()=>{const e=new Date;return`${String(e.getFullYear())}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}`},f=()=>{const e=u();return e?`${m(e)}-image`:`image-${g()}`},b=e=>(e||"").toString().trim().toLowerCase().replace(/[^a-z0-9.-]+/g,"-").replace(/(^[.-]+|[.-]+$)/g,""),w=()=>{const e=m(u()),t=g(),a=[{label:"Date",value:`image-${t}`}];return e&&a.unshift({label:"Post title",value:`${e}-image`},{label:"Post title + date",value:`${e}-${t}`}),a};(0,t.registerPlugin)("block-editor-image-filename-prompt",{render:function(){const[e,t]=(0,i.useState)(!1),[n,c]=(0,i.useState)(null),[d,m]=(0,i.useState)("image/png"),[u,g]=(0,i.useState)(f()),[h,v]=(0,i.useState)(""),[y,x]=(0,i.useState)(""),[S,j]=(0,i.useState)(""),[$,C]=(0,i.useState)(""),[D,P]=(0,i.useState)(!1),F=(0,i.useRef)(!1);(0,i.useEffect)(()=>{F.current=e},[e]),(0,i.useEffect)(()=>{const e=e=>{const a=e.clipboardData?.items;if(!a||F.current)return;const i=Array.from(a).find(e=>e.type&&e.type.startsWith("image/")),n=e.clipboardData?.files,r=n?Array.from(n).find(e=>e.type&&e.type.startsWith("image/")):null;if(i||r){e.preventDefault();const a=r||i.getAsFile();if(!a)return;return g(f()),c(a),m(i?.type||a.type||"image/png"),void t(!0)}const o=e.clipboardData?.getData("text/html"),l=(e=>{if(!e)return"";try{const t=(new DOMParser).parseFromString(e,"text/html");return t?.querySelector("img")?.getAttribute("src")||""}catch(e){return""}})(o),d=e.clipboardData?.getData("text/plain"),p=l||((e=>{const t=(e||"").toString().trim();if(!t)return!1;if(t.startsWith("data:image/"))return!0;try{const e=new URL(t);return/\.(png|jpe?g|gif|webp|avif|bmp|tiff?)$/i.test(e.pathname)}catch(e){return!1}})(d)?d:"");p&&(e.preventDefault(),(async()=>{try{const{blob:e,mime:a}=await(async e=>{const t=await fetch(e,{credentials:"omit"});if(!t.ok)throw new Error("Unable to fetch image from clipboard URL.");const a=await t.blob();return{blob:a,mime:t.headers.get("content-type")||a.type||"image/png"}})(p);g(f()),c(e),m(a),t(!0)}catch(e){(0,s.dispatch)("core/notices").createErrorNotice(`Paste upload failed: ${e?.message||e}`,{isDismissible:!0})}})())},a=new Set,i=t=>{t&&!a.has(t)&&(t.addEventListener("paste",e,!0),a.add(t))},n=()=>{const e=document.querySelector('iframe[name="editor-canvas"]'),t=e?.contentDocument;t&&i(t)},r=new MutationObserver(n);return i(document),n(),r.observe(document.documentElement,{childList:!0,subtree:!0}),()=>{a.forEach(t=>t.removeEventListener("paste",e,!0)),a.clear(),r.disconnect()}},[]);const E=()=>{D||(t(!1),c(null),v(""),x(""),j(""),C(""))},T=p(d||n?.type),k=`${b(u)||f()}.${T}`;return(0,l.jsx)(l.Fragment,{children:e&&(0,l.jsxs)(a.Modal,{title:"Name pasted image",onRequestClose:E,children:[(0,l.jsxs)("div",{style:{marginBottom:16},children:[(0,l.jsx)("div",{style:{fontSize:12,fontWeight:600,letterSpacing:.3,textTransform:"uppercase",color:"#1d2327",marginBottom:6},children:"Presets"}),(0,l.jsx)(a.ButtonGroup,{children:w().map(e=>(0,l.jsx)(a.Button,{variant:"secondary",onClick:()=>g(e.value),disabled:D,className:u===e.value?"is-selected":void 0,children:e.label},e.label))})]}),(0,l.jsx)(a.TextControl,{label:"Filename",value:u,onChange:g,disabled:D,placeholder:"example-image",help:(B=u,/\.[a-z0-9]{1,6}$/i.test(B||"")?`You entered an extension; .${T} will still be added.`:void 0)}),(0,l.jsxs)("div",{style:{marginTop:6,marginBottom:6,color:"#646970",fontSize:12},children:["Final file: ",k]}),(0,l.jsx)(a.TextControl,{label:"Alternative Text",value:h,onChange:v,disabled:D}),(0,l.jsx)(a.TextControl,{label:"Title",value:y,onChange:x,disabled:D}),(0,l.jsx)(a.TextControl,{label:"Caption",value:S,onChange:j,disabled:D}),(0,l.jsx)(a.TextControl,{label:"Description",value:$,onChange:C,disabled:D}),(0,l.jsxs)(a.Flex,{justify:"flex-end",gap:2,children:[(0,l.jsx)(a.FlexItem,{children:(0,l.jsx)(a.Button,{variant:"tertiary",onClick:E,disabled:D,children:"Cancel"})}),(0,l.jsx)(a.FlexItem,{children:(0,l.jsx)(a.Button,{variant:"primary",onClick:async()=>{if(n){P(!0);try{const e=p(d||n.type),t=`${b(u)||f()}.${e}`,a=new File([n],t,{type:d||n.type||"image/png"}),i=new FormData;i.append("file",a,t);const l=await r()({path:"/wp/v2/media",method:"POST",body:i}),c={};h&&(c.alt_text=h),y&&(c.title=y),S&&(c.caption=S),$&&(c.description=$),Object.keys(c).length&&await r()({path:`/wp/v2/media/${l.id}`,method:"POST",data:c});const m=l?.source_url;if(!m)throw new Error("Upload succeeded but no URL returned.");const g=(0,o.createBlock)("core/image",{id:l.id,url:m,alt:h||l?.alt_text||"",caption:S});(0,s.dispatch)("core/block-editor").insertBlocks(g),E()}catch(e){(0,s.dispatch)("core/notices").createErrorNotice(`Paste upload failed: ${e?.message||e}`,{isDismissible:!0})}finally{P(!1)}}},isBusy:D,disabled:D,children:"Upload and insert"})})]})]})});var B}})})();