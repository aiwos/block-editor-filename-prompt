(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.plugins,a=window.wp.components,n=window.wp.element,i=window.wp.apiFetch;var r=e.n(i);const o=window.wp.blocks,l=window.wp.data,s=window.ReactJSXRuntime,d=window.GIFilenamePrompt?.nonce||window.wpApiSettings?.nonce;d&&r().use(r().createNonceMiddleware(d));const c={"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp","image/avif":"avif"},p=e=>c[e]||"png",g=e=>(e||"").toString().trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||"pasted-image",u=()=>{const e=(0,l.select)("core/editor");return(e?.getEditedPostAttribute?e.getEditedPostAttribute("title"):"")||""},m=()=>{const e=new Date;return`${String(e.getFullYear())}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}`},w=()=>{const e=u();return e?`${g(e)}-image`:`image-${m()}`},f=e=>(e||"").toString().trim().toLowerCase().replace(/[^a-z0-9.-]+/g,"-").replace(/(^[.-]+|[.-]+$)/g,""),h=()=>{const e=g(u()),t=m(),a=[{label:"Date",value:`image-${t}`}];return e&&a.unshift({label:"Post title",value:`${e}-image`},{label:"Post title + date",value:`${e}-${t}`}),a};(0,t.registerPlugin)("gutenberg-image-filename-prompt",{render:function(){const[e,t]=(0,n.useState)(!1),[i,d]=(0,n.useState)(null),[c,g]=(0,n.useState)("image/png"),[u,m]=(0,n.useState)(w()),[v,b]=(0,n.useState)(!1),y=(0,n.useRef)(!1);(0,n.useEffect)(()=>{y.current=e},[e]),(0,n.useEffect)(()=>{const e=e=>{const a=e.clipboardData?.items;if(!a||y.current)return;const n=Array.from(a).find(e=>e.type&&e.type.startsWith("image/"));if(!n)return;e.preventDefault();const i=n.getAsFile();i&&(m(w()),d(i),g(n.type||i.type||"image/png"),t(!0))};return document.addEventListener("paste",e,!0),()=>document.removeEventListener("paste",e,!0)},[]);const x=()=>{v||(t(!1),d(null))},j=p(c||i?.type),S=`${f(u)||w()}.${j}`;return(0,s.jsx)(s.Fragment,{children:e&&(0,s.jsxs)(a.Modal,{title:"Name pasted image",onRequestClose:x,children:[(0,s.jsxs)("div",{style:{marginBottom:16},children:[(0,s.jsx)("div",{style:{fontSize:12,fontWeight:600,letterSpacing:.3,textTransform:"uppercase",color:"#1d2327",marginBottom:6},children:"Presets"}),(0,s.jsx)(a.ButtonGroup,{children:h().map(e=>(0,s.jsx)(a.Button,{variant:"secondary",onClick:()=>m(e.value),disabled:v,className:u===e.value?"is-selected":void 0,children:e.label},e.label))})]}),(0,s.jsx)(a.TextControl,{label:"Filename",value:u,onChange:m,disabled:v,placeholder:"example-image",help:($=u,/\.[a-z0-9]{1,6}$/i.test($||"")?`You entered an extension; .${j} will still be added.`:void 0)}),(0,s.jsxs)("div",{style:{marginTop:6,marginBottom:6,color:"#646970",fontSize:12},children:["Final file: ",S]}),(0,s.jsxs)(a.Flex,{justify:"flex-end",gap:2,children:[(0,s.jsx)(a.FlexItem,{children:(0,s.jsx)(a.Button,{variant:"tertiary",onClick:x,disabled:v,children:"Cancel"})}),(0,s.jsx)(a.FlexItem,{children:(0,s.jsx)(a.Button,{variant:"primary",onClick:async()=>{if(i){b(!0);try{const e=p(c||i.type),t=`${f(u)||w()}.${e}`,a=new File([i],t,{type:c||i.type||"image/png"}),n=new FormData;n.append("file",a,t);const s=await r()({path:"/wp/v2/media",method:"POST",body:n}),d=s?.source_url;if(!d)throw new Error("Upload succeeded but no URL returned.");const g=(0,o.createBlock)("core/image",{id:s.id,url:d,alt:s?.alt_text||""});(0,l.dispatch)("core/block-editor").insertBlocks(g),x()}catch(e){(0,l.dispatch)("core/notices").createErrorNotice(`Paste upload failed: ${e?.message||e}`,{isDismissible:!0})}finally{b(!1)}}},isBusy:v,disabled:v,children:"Upload and insert"})})]})]})});var $}})})();